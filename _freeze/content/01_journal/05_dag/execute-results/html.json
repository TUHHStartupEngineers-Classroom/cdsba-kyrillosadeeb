{
  "hash": "d74b980fd5aa49ab361fc7f22888f4c1",
  "result": {
    "markdown": "---\ntitle: \"Directed Acyclic Graphs\"\n---\n\n\n# Assignment 7\n\n## Parking spots example\n\nIn the parking spots example we had the parking spots as treatment variables, the stores as observation units and the sales as an outcome also taking into consideration the location as a confounder.\n\n\n::: {.cell hash='05_dag_cache/html/unnamed-chunk-1_ad24bc5c7317196b08ef0f4a83625532'}\n\n```{.r .cell-code}\n# Load packages\nlibrary(dagitty)\nlibrary(ggdag)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n#> \n#> Attaching package: 'ggdag'\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\n#> The following object is masked from 'package:stats':\n#> \n#>     filter\n```\n:::\n\n```{.r .cell-code}\nlibrary(ggplot2)\n\n#Create DAG model\nparking_model <- dagify(\n  S ~ L,\n  A ~ P,\n  B ~ P,\n  C ~ P,\n  D ~ P,\n  S ~ A,\n  S ~ B,\n  S ~ C,\n  S ~ D,\n  coords = list(x = c(L = 7,P = 1,A = 3,B = 3,C = 3,D = 3,S = 7),\n                y = c(L = 1,P = 0,A = 1,B = 0.5,C = -0.5,D = -1,S = 0)),\n  labels = list(L=\"location\",\n                P = \"parking spots\",\n                A = \"Store A\",\n                B = \"Store B\",\n                C = \"Store C\",\n                D = \"Store D\",\n                S = \"Sales\")\n)\n\n#Plot DAG model\nggdag(parking_model) +\n  theme_dag()+\n  geom_dag_node(color = \"red\")+\n  geom_dag_text(color = \"white\") +\n  geom_dag_edges(edge_color = \"black\") +\n  geom_dag_label_repel(aes(label = label))\n```\n\n::: {.cell-output-display}\n![](05_dag_files/figure-html/unnamed-chunk-1-1.png){width=672}\n:::\n:::\n\n\n\n## Customer Satisfaction\n\n### Linear reaggression\n\n\n::: {.cell hash='05_dag_cache/html/unnamed-chunk-2_1d699c668d6b69544fef7e6e29a63996'}\n\n```{.r .cell-code}\nlibrary(tidyverse)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n#> ── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──\n#> ✔ dplyr     1.1.3     ✔ readr     2.1.4\n#> ✔ forcats   1.0.0     ✔ stringr   1.5.0\n#> ✔ lubridate 1.9.3     ✔ tibble    3.2.1\n#> ✔ purrr     1.0.2     ✔ tidyr     1.3.0\n#> ── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──\n#> ✖ dplyr::filter() masks ggdag::filter(), stats::filter()\n#> ✖ dplyr::lag()    masks stats::lag()\n#> ℹ Use the conflicted package (<http://conflicted.r-lib.org/>) to force all conflicts to become errors\n```\n:::\n\n```{.r .cell-code}\ncustomer_sat <- readRDS(\"~/Documents/TUHH/Casual Data Science for Business Analytics/Causal_Data_Science_Data/customer_sat.rds\")\nhead(customer_sat)\n```\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"follow_ups\"],\"name\":[1],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"satisfaction\"],\"name\":[2],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"subscription\"],\"name\":[3],\"type\":[\"chr\"],\"align\":[\"left\"]}],\"data\":[{\"1\":\"8\",\"2\":\"40\",\"3\":\"Elite\"},{\"1\":\"7\",\"2\":\"45\",\"3\":\"Elite\"},{\"1\":\"8\",\"2\":\"47\",\"3\":\"Elite\"},{\"1\":\"9\",\"2\":\"44\",\"3\":\"Elite\"},{\"1\":\"10\",\"2\":\"50\",\"3\":\"Elite\"},{\"1\":\"6\",\"2\":\"55\",\"3\":\"Premium+\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n\n```{.r .cell-code}\nlm_first <- lm(satisfaction ~ follow_ups, data = customer_sat)\nsummary(lm_first)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#> \n#> Call:\n#> lm(formula = satisfaction ~ follow_ups, data = customer_sat)\n#> \n#> Residuals:\n#>     Min      1Q  Median      3Q     Max \n#> -12.412  -5.257   1.733   4.506  12.588 \n#> \n#> Coefficients:\n#>             Estimate Std. Error t value Pr(>|t|)    \n#> (Intercept)  78.8860     4.2717  18.467 1.04e-10 ***\n#> follow_ups   -3.3093     0.6618  -5.001 0.000243 ***\n#> ---\n#> Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n#> \n#> Residual standard error: 7.923 on 13 degrees of freedom\n#> Multiple R-squared:  0.658,\tAdjusted R-squared:  0.6316 \n#> F-statistic: 25.01 on 1 and 13 DF,  p-value: 0.0002427\n```\n:::\n\n```{.r .cell-code}\nlm_second <- lm(satisfaction ~ follow_ups + subscription, data = customer_sat)\nsummary(lm_second)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#> \n#> Call:\n#> lm(formula = satisfaction ~ follow_ups + subscription, data = customer_sat)\n#> \n#> Residuals:\n#>     Min      1Q  Median      3Q     Max \n#> -4.3222 -2.1972  0.3167  2.2667  3.9944 \n#> \n#> Coefficients:\n#>                      Estimate Std. Error t value Pr(>|t|)    \n#> (Intercept)           26.7667     6.6804   4.007  0.00206 ** \n#> follow_ups             2.1944     0.7795   2.815  0.01682 *  \n#> subscriptionPremium   44.7222     5.6213   7.956 6.88e-06 ***\n#> subscriptionPremium+  18.0722     2.1659   8.344 4.37e-06 ***\n#> ---\n#> Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n#> \n#> Residual standard error: 2.958 on 11 degrees of freedom\n#> Multiple R-squared:  0.9597,\tAdjusted R-squared:  0.9487 \n#> F-statistic: 87.21 on 3 and 11 DF,  p-value: 5.956e-08\n```\n:::\n:::\n\n\n### Comparing and Explanation\nOne of the possible reasons for having a negative estimate in the first regression and then a positive one in the second could be due to the nature of the follow-up calls. So when we speak about follow-ups in general its usually a problem and at lower subscription levels the solution could be to upgrade their subscription which is more expensive and hence the customer isn't satisfied with the outcome, it could also be a bug or a complain which applies to all subscription levels but when you factor in the subscription level the nature of the calls could be about an upgrade or an inquiry about a feature that gets resolved and the customer is satisfied. \n\nAnother explanation that appears later when plotting the data is that when we don't factor the subscription levels it shows that overall the more the follow-ups the less the satisfaction but when you factor the subscription you find that every subscription level has its own range of satisfaction which when isolated shows us an increase in satisfaction as the increase of follow-ups.\n\n### Plotting the data \n\n\n::: {.cell hash='05_dag_cache/html/unnamed-chunk-3_423bf3fa5354eccbf2533d3d8105be67'}\n\n```{.r .cell-code}\nno_sub_sat <- ggplot(customer_sat, aes(x = follow_ups, y = satisfaction)) +\n  geom_point(alpha = .8) +\n  stat_smooth(method = \"lm\", se = F)\n\nsub_sat <- ggplot(customer_sat, aes(x = follow_ups, y = satisfaction, color = subscription)) +\n  geom_point(alpha = .8) +\n  stat_smooth(method = \"lm\", se = F)\n\nno_sub_sat\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n#> `geom_smooth()` using formula = 'y ~ x'\n```\n:::\n\n::: {.cell-output-display}\n![](05_dag_files/figure-html/unnamed-chunk-3-1.png){width=672}\n:::\n\n```{.r .cell-code}\nsub_sat\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n#> `geom_smooth()` using formula = 'y ~ x'\n```\n:::\n\n::: {.cell-output-display}\n![](05_dag_files/figure-html/unnamed-chunk-3-2.png){width=672}\n:::\n:::\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<link href=\"../../site_libs/pagedtable-1.1/css/pagedtable.css\" rel=\"stylesheet\" />\n<script src=\"../../site_libs/pagedtable-1.1/js/pagedtable.js\"></script>\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}